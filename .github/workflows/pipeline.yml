name: CI/CD Pipeline

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]
  workflow_dispatch:

jobs:
  analyze-project:
    name: ðŸ” Project Analysis
    runs-on: ubuntu-latest
    outputs:
      has_npm: ${{ steps.check.outputs.has_npm }}
      has_python: ${{ steps.check.outputs.has_python }}
    steps:
      - uses: actions/checkout@v4
      - id: check
        run: |
          echo "has_npm=$(if [ -f "package.json" ]; then echo "true"; else echo "false"; fi)" >> $GITHUB_OUTPUT
          echo "has_python=$(if [ -f "requirements.txt" ] || [ -f "pyproject.toml" ]; then echo "true"; else echo "false"; fi)" >> $GITHUB_OUTPUT

  build:
    name: Build
    needs: analyze-project
    runs-on: ubuntu-latest
    if: needs.analyze-project.outputs.has_npm == 'true'
    steps:
      - uses: actions/checkout@v4
      
      - name: Install Dependencies
        run: npm ci --prefer-offline --no-audit || npm install

      - name: Build
        run: npm run build || echo "No build script"

  python-check:
    name: Python Check
    needs: analyze-project
    runs-on: ubuntu-latest
    if: needs.analyze-project.outputs.has_python == 'true'
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: pip install -r requirements.txt || echo "No requirements.txt"
